# ラボの解決策

ストレージアカウント内の`checkpoints`コンテナを開きます。これはプロセッサが状態を記録している場所です：

- イベントハブとコンシューマグループ名を含むフォルダ構造が見えます。
- 例：`<eh-name>.servicebus.windows.net/devicelogs/processing`
- そこには`checkpoint`と`ownership`の2つのフォルダがあります。
- それぞれにはパーティション用の0から4までの番号が付けられた5つのファイルがあります。
- ファイルは空です。オフセットとオーナーIDはメタデータとして保存されています。

プロセッサはこの方法でパーティションを割り当てます。メタデータにオーナーIDを記録することによってです。各オーナーは、そのパーティションに対して処理した最後のオフセットをチェックポイントファイルに記録します。

プロセッサを停止すると、他のプロセッサがそのパーティション（複数可）の所有権を取得し、最後のメッセージから処理を再開します。これには数分かかります。ライブラリはパーティションが本当に処理されていないことを確認してから再割り当てを行うため、2つのプロセッサが同時に作業することがないようにするためです。
