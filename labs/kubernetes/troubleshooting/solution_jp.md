# ラボソリューション

私の解決策はこちらです：

- [deployment.yaml](solution/deployment.yaml)
- [service.yaml](solution/service.yaml)

これをデプロイすれば、アプリは動作します：



```
kubectl apply -f labs/kubernetes/troubleshooting/solution

curl http://localhost:8020
```


## デプロイメントのトラブルシューティング

修正点：

1. デプロイメントセレクターに合わせてポッド仕様のラベルを編集しました。

2. レプリカ数を1に設定しました。0も完全に有効ですが、アプリが使用されていないときにコンピューティングパワーを節約するためですが、デフォルトとしてはあまり良くありません :)

3. リソース要求を減らしました。大きな数字も有効ですが、そのパワーを提供できるノードがクラスターにない場合、ポッドは保留状態になります。

4. イメージ名を修正しました。`ErrImagePull`はイメージ名が間違っているか、ポッドがプライベートイメージをプルする権限を持っていないことを示します。

5. コンテナコマンドのタイプミスを修正しました。`RunContainerError`は、Kubernetesがコンテナを実行できないことを意味します - 失敗に応じて、ポッドのログや説明にエラーが表示されます。

6. レディネスプローブを修正しました。TCPソケットがリスニングしていることを確認するように設定されていますが、間違ったポートを使用しています。`8020`はサービスポートで、コンテナ内のアプリはポート`80`を使用します。

7. ライブネスプローブを修正しました。HTTPエンドポイントを確認するように設定されていますが、/healthyは存在しません - 404レスポンスはプローブの失敗を意味します。

## サービスのトラブルシューティング

修正点：

1. NodePortサービスのターゲットポートを修正しました。8020は有効ではありません。

2. ポッド仕様のラベルに合わせてサービスセレクターを編集しました。エンドポイントがない場合、それは一致するポッドがないことを意味します。

3. サービス仕様のターゲットポート名をコンテナ仕様と一致させて修正しました。名前を使用することはポート番号よりも柔軟ですが、名前が一致しない場合、エラーは表示されません - エンドポイントリストが空になるだけです。
